<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Chat Insights</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body>
    <h3 onclick="refresh()">Median response time per hour</h3>
    <div id="myDiv" style="width: 800px; height: 600px;"></div>

    <button onclick="refresh()">Refresh</button>
    <script>
        var json = {};
        refresh();
        console.log(json);

        function refresh() {
            $.getJSON("data.json", function(dataJson) {
                json = dataJson;
                console.log("JSON Data: " + dataJson);
                //This converts null values into the data point before it.
                for (var i = 0; i < json["Delta"].length; i++) {
                    if (json["Delta"][i] == null) {
                        json["Delta"][i] = json["Delta"][i - 1]
                    }
                }

                var jsonDataAdjusted = {
                    "Hour": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23],
                    "RawTime": [
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        [],
                        []
                    ],
                    "Median": []
                }
                console.log(jsonDataAdjusted);

                var time = json["Timestamps"][0];

                for (var i = 0; i < json["Delta"].length; i++) {
                    if (i == 0) {
                        switch (new Date(time).getHours()) {
                            case 0:
                                jsonDataAdjusted["RawTime"][0].push(0);
                                break;
                            case 1:
                                jsonDataAdjusted["RawTime"][1].push(0);
                                break;
                            case 2:
                                jsonDataAdjusted["RawTime"][2].push(0);
                                break;
                            case 3:
                                jsonDataAdjusted["RawTime"][3].push(0);
                                break;
                            case 4:
                                jsonDataAdjusted["RawTime"][4].push(0);
                                break;
                            case 5:
                                jsonDataAdjusted["RawTime"][5].push(0);
                                break;
                            case 6:
                                jsonDataAdjusted["RawTime"][6].push(0);
                                break;
                            case 7:
                                jsonDataAdjusted["RawTime"][7].push(0);
                                break;
                            case 8:
                                jsonDataAdjusted["RawTime"][8].push(0);
                                break;
                            case 9:
                                jsonDataAdjusted["RawTime"][9].push(0);
                                break;
                            case 10:
                                jsonDataAdjusted["RawTime"][10].push(0);
                                break;
                            case 11:
                                jsonDataAdjusted["RawTime"][11].push(0);
                                break;
                            case 12:
                                jsonDataAdjusted["RawTime"][12].push(0);
                                break;
                            case 13:
                                jsonDataAdjusted["RawTime"][13].push(0);
                                break;
                            case 14:
                                jsonDataAdjusted["RawTime"][14].push(0);
                                console.log(jsonDataAdjusted["RawTime"][14]);
                                break;
                            case 15:
                                jsonDataAdjusted["RawTime"][15].push(0);
                                break;
                            case 16:
                                jsonDataAdjusted["RawTime"][16].push(0);
                                break;
                            case 17:
                                jsonDataAdjusted["RawTime"][17].push(0);
                                break;
                            case 18:
                                jsonDataAdjusted["RawTime"][18].push(0);
                                break;
                            case 19:
                                jsonDataAdjusted["RawTime"][19].push(0);
                                break;
                            case 20:
                                jsonDataAdjusted["RawTime"][20].push(0);
                                break;
                            case 21:
                                jsonDataAdjusted["RawTime"][21].push(0);
                                break;
                            case 22:
                                jsonDataAdjusted["RawTime"][22].push(0);
                                break;
                            case 23:
                                jsonDataAdjusted["RawTime"][23].push(0);
                                break;
                        }

                    }
                    time += json["Delta"][i];
                    switch (new Date(time).getHours()) {
                        case 0:
                            jsonDataAdjusted["RawTime"][0].push(json["Delta"][i]);
                            break;
                        case 1:
                            jsonDataAdjusted["RawTime"][1].push(json["Delta"][i]);
                            break;
                        case 2:
                            jsonDataAdjusted["RawTime"][2].push(json["Delta"][i]);
                            break;
                        case 3:
                            jsonDataAdjusted["RawTime"][3].push(json["Delta"][i]);
                            break;
                        case 4:
                            jsonDataAdjusted["RawTime"][4].push(json["Delta"][i]);
                            break;
                        case 5:
                            jsonDataAdjusted["RawTime"][5].push(json["Delta"][i]);
                            break;
                        case 6:
                            jsonDataAdjusted["RawTime"][6].push(json["Delta"][i]);
                            break;
                        case 7:
                            jsonDataAdjusted["RawTime"][7].push(json["Delta"][i]);
                            break;
                        case 8:
                            jsonDataAdjusted["RawTime"][8].push(json["Delta"][i]);
                            break;
                        case 9:
                            jsonDataAdjusted["RawTime"][9].push(json["Delta"][i]);
                            break;
                        case 10:
                            jsonDataAdjusted["RawTime"][10].push(json["Delta"][i]);
                            break;
                        case 11:
                            jsonDataAdjusted["RawTime"][11].push(json["Delta"][i]);
                            break;
                        case 12:
                            jsonDataAdjusted["RawTime"][12].push(json["Delta"][i]);
                            break;
                        case 13:
                            jsonDataAdjusted["RawTime"][13].push(json["Delta"][i]);
                            break;
                        case 14:
                            jsonDataAdjusted["RawTime"][14].push(json["Delta"][i]);
                            console.log(jsonDataAdjusted["RawTime"][14]);
                            break;
                        case 15:
                            jsonDataAdjusted["RawTime"][15].push(json["Delta"][i]);
                            break;
                        case 16:
                            jsonDataAdjusted["RawTime"][16].push(json["Delta"][i]);
                            break;
                        case 17:
                            jsonDataAdjusted["RawTime"][17].push(json["Delta"][i]);
                            break;
                        case 18:
                            jsonDataAdjusted["RawTime"][18].push(json["Delta"][i]);
                            break;
                        case 19:
                            jsonDataAdjusted["RawTime"][19].push(json["Delta"][i]);
                            break;
                        case 20:
                            jsonDataAdjusted["RawTime"][20].push(json["Delta"][i]);
                            break;
                        case 21:
                            jsonDataAdjusted["RawTime"][21].push(json["Delta"][i]);
                            break;
                        case 22:
                            jsonDataAdjusted["RawTime"][22].push(json["Delta"][i]);
                            break;
                        case 23:
                            jsonDataAdjusted["RawTime"][23].push(json["Delta"][i]);
                            break;
                    }
                }
                console.log(jsonDataAdjusted["RawTime"]);

                for (var i = 0; i < 24; i++) {
                    var times = jsonDataAdjusted["RawTime"][i];
                    if (times.length == 0) {
                        times = 0;
                    } else if (times.length == 1) {
                        times = times[0];
                    } else {
                        times = times[times.length / 2];
                    }
                    jsonDataAdjusted["Median"][i] = times / 1000;
                }

                console.log(jsonDataAdjusted)

                var medianResponseTime = {
                    x: jsonDataAdjusted["Hour"],
                    y: jsonDataAdjusted["Median"],
                    type: 'scatter'
                };

                var data = [medianResponseTime]; //Add ",trace2" for another line

                Plotly.newPlot('myDiv', data, {
                    title: "Median Message Response Time by the Hour",
                    xaxis: {
                        title: "Time (24 Hour)"
                    },
                    yaxis: {
                        title: "Response Time (Seconds)"
                    }
                });
            });
        }
    </script>
</body>

</html>
